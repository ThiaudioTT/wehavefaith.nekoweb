---
interface Props {
  k?: number; // Speed factor: higher K = faster rain. Default is 1
  count?: number; // Number of raindrops
}

const { k = 1, count = 100 } = Astro.props;
---

<div class="rain-container" id="rain-container" data-k={k} data-count={count}>
</div>

<style>
  .rain-container {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: 1;
    overflow: hidden;
  }

  :global(.raindrop) {
    position: absolute;
    top: -30px;
    width: 1px;
    height: 25px;
    background: linear-gradient(
      to bottom,
      transparent,
      rgba(255, 255, 255, 0.8)
    );
    border-radius: 0 0 1px 1px;
    animation: fall linear infinite;
  }

  @keyframes fall {
    0% {
      transform: translateY(0);
      opacity: 1;
    }
    100% {
      transform: translateY(100vh);
      opacity: 0.3;
    }
  }
</style>

<script>
  function createRain() {
    const container = document.getElementById("rain-container");
    if (!container) return;

    const k = parseFloat(container.dataset.k || "1");
    const count = parseInt(container.dataset.count || "100");

    // Base duration is 3 seconds, divided by K for speed control
    const baseDuration = 3 / k;

    for (let i = 0; i < count; i++) {
      const drop = document.createElement("div");
      drop.className = "raindrop";
      drop.style.left = Math.random() * 100 + "%";
      drop.style.animationDuration = Math.random() * 1 + baseDuration + "s";
      drop.style.animationDelay = Math.random() * 3 + "s";
      drop.style.opacity = String(Math.random() * 0.5 + 0.3);
      container.appendChild(drop);
    }
  }

  createRain();
</script>
